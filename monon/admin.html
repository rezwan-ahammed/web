<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Exam Creator</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg-color: #F8F9FA; --primary-text-color: #121212; --accent-color: #3D52F3; --accent-color-dark: #2335D8; --border-color: rgba(0, 0, 0, 0.1); --shadow-color: rgba(0, 0, 0, 0.04); }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg-color); color: var(--primary-text-color); margin: 0; padding: 2rem; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 2rem; border-radius: 12px; box-shadow: 0 10px 40px var(--shadow-color); }
        h1, h2 { text-align: center; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; font-weight: 700; margin-bottom: 0.5rem; }
        input[type="text"], input[type="number"] { width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        .btn { display: inline-block; background-color: var(--accent-color); color: #FFF; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 500; border: none; cursor: pointer; transition: all .3s ease; }
        .btn:hover { background-color: var(--accent-color-dark); }
        .btn-secondary { background-color: #6c757d; }
        .question-card { background: #f8f9fa; border: 1px solid var(--border-color); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; }
        .remove-btn { float: right; background: #dc3545; color: white; border-radius: 50%; border: none; width: 25px; height: 25px; cursor: pointer; }
        #notification { text-align: center; font-weight: bold; color: var(--accent-color); margin-top: 1.5rem; background: #eef1ff; padding: 1rem; border-radius: 8px; }
        #notification code { background: #dce2ff; padding: 2px 6px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Admin Panel - Exam Creator</h1>
        <div class="form-group"><label for="exam-title">Exam Title</label><input type="text" id="exam-title" placeholder="e.g., Final Physics Examination"></div>
        <div class="form-group"><label for="exam-duration">Exam Duration (Minutes)</label><input type="number" id="exam-duration" placeholder="e.g., 90"></div>
        <h2>Questions</h2>
        <div id="questions-container"></div>
        <div class="form-group">
            <button class="btn btn-secondary" id="add-cq-btn">Add Written Question (CQ)</button>
            <button class="btn btn-secondary" id="add-mcq-btn">Add Multiple Choice (MCQ)</button>
        </div>
        <hr style="margin: 2rem 0; border: 1px solid #f0f0f0;">
        <div style="text-align: center;">
            <button class="btn" id="save-exam-btn" style="font-size: 1.2rem; padding: 1rem 2.5rem;">Save Exam to Firebase</button>
            <p id="notification" style="display: none;"></p>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database-compat.js"></script>

    <script>
        // --- YOUR FIREBASE CONFIGURATION ---
        const firebaseConfig = { apiKey: "AIzaSyAPgoVPBdYnnMHRnKbGJIe87HJ_Py82XUQ", authDomain: "mathemate-software.firebaseapp.com", databaseURL: "https://mathemate-software-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "mathemate-software", storageBucket: "mathemate-software.appspot.com", messagingSenderId: "780184955321", appId: "YOUR_WEB_APP_ID" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const questionsContainer = document.getElementById('questions-container');
        let questionCounter = 0;

        document.getElementById('add-cq-btn').addEventListener('click', () => addQuestion('CQ'));
        document.getElementById('add-mcq-btn').addEventListener('click', () => addQuestion('MCQ'));

        function addQuestion(type) {
            // ... (addQuestion function is identical to the previous version)
            questionCounter++;
            const questionId = `q-${questionCounter}`;
            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = questionId;
            let content = `<button class="remove-btn" onclick="document.getElementById('${questionId}').remove()">X</button><h4>Question ${questionCounter} (${type})</h4><div class="form-group"><label>Question Text</label><input type="text" class="question-text" placeholder="Enter the question"></div>`;
            if (type === 'MCQ') {
                content += `<div class="mcq-options"><label>Options (Select correct answer)</label>${[...Array(4)].map((_, i) => `<div style="display: flex; align-items: center; gap: 10px;"><input type="radio" name="correct-${questionId}" value="${i}" required><input type="text" class="option-text" placeholder="Option ${i + 1}"></div>`).join('')}</div>`;
            }
            card.innerHTML = content;
            card.dataset.type = type;
            questionsContainer.appendChild(card);
        }

        document.getElementById('save-exam-btn').addEventListener('click', () => {
            const exam = {
                title: document.getElementById('exam-title').value,
                duration: parseInt(document.getElementById('exam-duration').value, 10),
                questions: []
            };

            if (!exam.title || !exam.duration) {
                alert('Please provide an exam title and duration.');
                return;
            }
            
            // ... (Validation and question collection logic is identical to previous version) ...
            const questionCards = questionsContainer.querySelectorAll('.question-card');
            for (const card of questionCards) {
                const question = { type: card.dataset.type, text: card.querySelector('.question-text').value };
                if (question.type === 'MCQ') {
                    question.options = [...card.querySelectorAll('.option-text')].map(opt => opt.value);
                    const correctRadio = card.querySelector(`input[name="correct-${card.id}"]:checked`);
                    question.correct = correctRadio ? parseInt(correctRadio.value, 10) : -1;
                    if (question.correct === -1) { alert(`Please select a correct answer for question: "${question.text}"`); return; }
                }
                exam.questions.push(question);
            }

            // --- FIREBASE INTEGRATION ---
            const examsRef = database.ref('exams');
            const newExamRef = examsRef.push();
            newExamRef.set(exam)
                .then(() => {
                    const notification = document.getElementById('notification');
                    notification.innerHTML = `âœ… Exam saved successfully!<br>Share this Exam ID with students: <code>${newExamRef.key}</code>`;
                    notification.style.display = 'block';
                })
                .catch((error) => {
                    console.error("Error saving exam: ", error);
                    alert("Could not save the exam to Firebase. Check console for errors.");
                });
        });
    </script>
</body>
</html>
