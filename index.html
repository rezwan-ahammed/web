<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Professional Portfolio | Secure Social</title>
    <!-- Core Infrastructure -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap');
        
        :root { 
            --paper: #FDFBF7; 
            --accent: #0084FF; 
            --text: #1A1A1A;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f1f5f9; 
            color: var(--text); 
            margin: 0; 
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }

        .font-serif { font-family: 'Playfair Display', serif; }
        
        /* Main Shell */
        .app-shell { 
            width: 100%; max-width: 480px; min-height: 100vh; background: var(--paper); 
            margin: 0 auto; position: relative; box-shadow: 0 10px 100px rgba(0,0,0,0.1); 
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* Messenger & Feed Glitch Fixes */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .btn-press:active { transform: scale(0.96); transition: 0.1s; }
        .pb-safe { padding-bottom: calc(var(--safe-bottom) + 84px); }
        .pt-safe { padding-top: var(--safe-top); }
        
        .glass { background: rgba(253, 251, 247, 0.85); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); }

        /* Dynamic Island - High Precision */
        @keyframes islandAnim { 0% { transform: translate(-50%, -100%); } 15% { transform: translate(-50%, 16px); } 85% { transform: translate(-50%, 16px); } 100% { transform: translate(-50%, -100%); } }
        .island-pill { position: fixed; left: 50%; top: 0; z-index: 1000; background: #000; color: white; padding: 10px 22px; border-radius: 99px; font-size: 11px; font-weight: 800; animation: islandAnim 4s cubic-bezier(0.16, 1, 0.3, 1) forwards; display: flex; align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,0.15); letter-spacing: 0.05em; }

        /* Messenger Physics */
        .chat-bubble { max-width: 85%; padding: 12px 16px; font-size: 15px; font-weight: 500; line-height: 1.5; }
        .b-visitor { background: var(--accent); color: white; border-radius: 22px 22px 4px 22px; }
        .b-admin { background: #E4E6EB; color: black; border-radius: 22px 22px 22px 4px; }
        
        /* Camera UI - Professional Scan Effect */
        .camera-container { width: 280px; height: 280px; border-radius: 999px; overflow: hidden; position: relative; border: 4px solid white; box-shadow: 0 0 0 4px var(--accent), 0 20px 50px rgba(0,0,0,0.2); }
        .video-feed { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        
        @keyframes scanMove { 0% { top: 0; opacity: 0.3; } 50% { top: 100%; opacity: 1; } 100% { top: 0; opacity: 0.3; } }
        .scan-line { position: absolute; width: 100%; height: 2px; background: var(--accent); box-shadow: 0 0 20px var(--accent); z-index: 10; animation: scanMove 3s infinite linear; }
        
        .shimmer { background: linear-gradient(90deg, #f0f0f0 25%, #f8f8f8 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        .animate-modal { animation: modalSlide 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes modalSlide { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- PRODUCTION CONFIG ---
        const CONFIG = {
            apiKey: "AIzaSyAH5NrTOu9uT9_WMBlBhJS4Dqd-qkPEYs8",
            authDomain: "general-57884.firebaseapp.com",
            databaseURL: "https://general-57884-default-rtdb.firebaseio.com",
            projectId: "general-57884",
            appId: "1:5002724584:web:80fde1ae04c6276eb9b55d"
        };
        const DATA_PATH = "artifacts/main-portfolio/public/data";

        // --- ICON SYSTEM ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const paths = {
                home: "M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",
                search: "M11 19a8 8 0 100-16 8 8 0 000 16zM21 21l-4.35-4.35",
                plus: "M12 5v14M5 12h14",
                heart: "M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z",
                user: "M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2",
                shield: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
                send: "M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z",
                image: "M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2zM12 17a4 4 0 100-8 4 4 0 000 8z",
                arrow: "M19 12H5M12 19l-7-7 7-7",
                x: "M18 6L6 18M6 6l12 12"
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d={paths[name] || ""} />
                    {name === 'user' && <circle cx="12" cy="7" r="4" />}
                    {name === 'camera' && <circle cx="12" cy="13" r="3" />}
                </svg>
            );
        };

        function App() {
            const [profile, setProfile] = useState(null);
            const [posts, setPosts] = useState([]);
            const [gateAction, setGateAction] = useState(null);
            const [visitor, setVisitor] = useState(null);
            const [isAutoLogging, setIsAutoLogging] = useState(false);
            const [tab, setTab] = useState('home');
            
            const rtdb = useRef(null);

            // LOGIC: Military-Grade Hardware Fingerprint
            const getFingerprint = () => {
                const parts = [
                    navigator.userAgent,
                    navigator.language,
                    screen.colorDepth,
                    screen.width + 'x' + screen.height,
                    navigator.hardwareConcurrency || 'unk',
                    navigator.deviceMemory || 'unk'
                ];
                return btoa(parts.join('|')).replace(/=/g, '').substring(0, 32);
            };

            useEffect(() => {
                if (!firebase.apps.length) firebase.initializeApp(CONFIG);
                rtdb.current = firebase.database();
                
                firebase.auth().signInAnonymously().then(() => {
                    const fp = getFingerprint();
                    
                    // Recognition Logic
                    rtdb.current.ref(`${DATA_PATH}/device_trust/${fp}`).once('value', snap => {
                        if(snap.exists()) {
                            setVisitor(snap.val());
                            setIsAutoLogging(true);
                        }
                    });

                    // Live Data Sync
                    rtdb.current.ref(`${DATA_PATH}/profile`).on('value', s => setProfile(s.val()));
                    rtdb.current.ref(`${DATA_PATH}/posts`).on('value', s => {
                        const val = s.val();
                        if(val) setPosts(Object.keys(val).map(k => ({id:k, ...val[k]})).sort((a,b)=>b.timestamp-a.timestamp));
                    });
                });
            }, []);

            return (
                <div className="app-shell">
                    {isAutoLogging && visitor && (
                        <div className="island-pill uppercase">
                            <span className="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span>
                            Verified: {visitor.name}
                        </div>
                    )}

                    <header className="sticky top-0 z-40 glass px-6 py-5 border-b border-slate-100 flex justify-between items-center pt-safe">
                        <div className="font-serif font-black text-2xl tracking-tighter text-slate-900">portfolio.</div>
                        <div className="flex items-center gap-3">
                            <Icon name="search" size={20} className="text-slate-300" />
                            {visitor && <img src={visitor.selfieData} className="w-9 h-9 rounded-xl object-cover border-2 border-blue-500 shadow-sm" />}
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto no-scrollbar pb-safe">
                        <div className="animate-in fade-in duration-700">
                            {tab === 'home' && (
                                <>
                                    <section className="px-6 py-10">
                                        <div className="flex justify-between items-start mb-8">
                                            <div className="w-24 h-24 rounded-[2.5rem] border-4 border-white shadow-2xl overflow-hidden bg-slate-100">
                                                {profile?.avatar ? <img src={profile.avatar} className="w-full h-full object-cover" /> : <div className="w-full h-full shimmer" />}
                                            </div>
                                            <div className="flex flex-col gap-2 mt-2">
                                                <button onClick={() => setGateAction(visitor ? 'messenger' : 'gatekeeper')} className="bg-gray-900 text-white px-8 py-3.5 rounded-2xl font-bold text-sm btn-press shadow-xl">Connect</button>
                                            </div>
                                        </div>
                                        <h1 className="text-3xl font-black tracking-tight leading-none text-slate-900">{profile?.name || "Initializing..."}</h1>
                                        <p className="text-blue-600 font-bold text-sm mt-2">{profile?.handle}</p>
                                        <p className="mt-5 text-slate-600 leading-relaxed font-medium text-[15px] pr-4">{profile?.bio}</p>
                                    </section>

                                    <div className="divide-y border-t border-slate-100 bg-white">
                                        {posts.map(p => (
                                            <div key={p.id} className="p-6 transition-colors hover:bg-gray-50/50">
                                                <div className="flex gap-4">
                                                    <div className="w-10 h-10 rounded-2xl overflow-hidden shrink-0 border border-slate-100 bg-slate-50">
                                                        <img src={profile?.avatar} className="w-full h-full object-cover" />
                                                    </div>
                                                    <div className="flex-1 min-w-0">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <span className="font-bold text-sm">{profile?.name}</span>
                                                            <span className="text-[10px] font-black text-slate-200 uppercase">Project Update</span>
                                                        </div>
                                                        <h3 className="font-bold text-lg text-slate-800 leading-tight">{p.title}</h3>
                                                        <p className="text-slate-500 text-[15px] leading-relaxed mt-2">{p.content}</p>
                                                        {p.imageUrl && <img src={p.imageUrl} className="rounded-3xl mt-4 w-full border border-slate-100 shadow-sm aspect-video object-cover" />}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </>
                            )}
                        </div>
                    </main>

                    <nav className="fixed bottom-0 w-full max-w-[480px] glass border-t border-slate-100 px-10 py-5 flex justify-between items-center z-50">
                        <button onClick={()=>setTab('home')} className={tab==='home'?'text-blue-600':'text-slate-300'}><Icon name="home" /></button>
                        <button className="text-slate-300"><Icon name="search" /></button>
                        <button onClick={() => setGateAction(visitor ? 'messenger' : 'gatekeeper')} className="bg-gray-900 text-white p-4 rounded-3xl shadow-xl -mt-12 border-[6px] border-[#FDFBF7] btn-press">
                            <Icon name="plus" size={26}/>
                        </button>
                        <Icon name="heart" className="text-slate-300" />
                        <Icon name="user" className="text-slate-300" />
                    </nav>

                    {gateAction === 'gatekeeper' && (
                        <Gatekeeper 
                            onClose={() => setGateAction(null)} 
                            onSuccess={(v) => {
                                rtdb.current.ref(`${DATA_PATH}/device_trust/${getFingerprint()}`).set(v);
                                setVisitor(v); setGateAction('messenger');
                            }}
                            rtdb={rtdb.current}
                        />
                    )}

                    {gateAction === 'messenger' && visitor && (
                        <Messenger onBack={() => setGateAction(null)} profile={profile} visitor={visitor} rtdb={rtdb.current} />
                    )}
                </div>
            );
        }

        const Gatekeeper = ({ onClose, onSuccess, rtdb }) => {
            const [step, setStep] = useState(1);
            const [name, setName] = useState("");
            const [idData, setIdData] = useState(null);
            const [isSyncing, setIsSyncing] = useState(false);
            const videoRef = useRef();

            // Cleanup Effect: Mandatory to kill camera on close
            useEffect(() => {
                return () => { if(videoRef.current?.srcObject) videoRef.current.srcObject.getTracks().forEach(t => t.stop()); };
            }, []);

            const compress = (source, size = 600) => {
                return new Promise(resolve => {
                    const img = new Image();
                    img.src = source;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const scale = size / Math.max(img.width, img.height);
                        canvas.width = img.width * scale; canvas.height = img.height * scale;
                        canvas.getContext('2d').drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.6));
                    };
                });
            };

            const captureBiometric = async () => {
                setIsSyncing(true);
                const canvas = document.createElement('canvas');
                canvas.width = 400; canvas.height = 400;
                canvas.getContext('2d').drawImage(videoRef.current, 0, 0, 400, 400);
                const selfie = canvas.toDataURL('image/jpeg', 0.6);
                const ts = Date.now();
                
                await rtdb.ref(`${DATA_PATH}/verifications/${ts}`).set({ name, idData, selfieData: selfie, ts });
                onSuccess({ name, selfieData: selfie, ts });
            };

            return (
                <div className="fixed inset-0 z-[100] bg-black/70 backdrop-blur-xl flex items-end justify-center p-4">
                    <div className="w-full max-w-sm bg-white rounded-[2.8rem] p-8 shadow-2xl animate-modal overflow-hidden">
                        {isSyncing && <div className="scan-line" />}
                        <div className="flex justify-between mb-8">
                            <Icon name="shield" className="text-blue-600" />
                            <button onClick={onClose}><Icon name="x" size={20} className="text-slate-400" /></button>
                        </div>

                        {step === 1 && (
                            <div>
                                <h2 className="text-2xl font-black mb-2">Secure Gateway</h2>
                                <p className="text-slate-400 text-sm mb-8 font-medium">Verification required for professional data access.</p>
                                <input className="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl mb-6 font-bold outline-none focus:ring-2 ring-blue-500/20 transition-all" placeholder="Full Legal Name" onChange={e=>setName(e.target.value)} />
                                <button disabled={!name} onClick={()=>setStep(2)} className="w-full bg-black text-white py-5 rounded-2xl font-black btn-press shadow-xl">Continue</button>
                            </div>
                        )}

                        {step === 2 && (
                            <div className="text-center">
                                <h2 className="text-2xl font-black mb-2 text-slate-900">ID Proof</h2>
                                <p className="text-slate-400 text-sm mb-8">Upload Work ID or Document.</p>
                                <label className="block w-full h-44 bg-slate-50 border-2 border-dashed border-slate-200 rounded-[2.5rem] flex flex-col items-center justify-center cursor-pointer overflow-hidden active:bg-slate-100 transition-all">
                                    {idData ? <img src={idData} className="w-full h-full object-cover" /> : <Icon name="camera" className="text-slate-200" size={32} />}
                                    <input type="file" className="hidden" accept="image/*" onChange={async (e) => {
                                        const r = new FileReader(); r.readAsDataURL(e.target.files[0]);
                                        r.onload = async (ev) => setIdData(await compress(ev.target.result));
                                    }} />
                                </label>
                                <button disabled={!idData} onClick={async ()=>{
                                    const s = await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}});
                                    setStep(3); setTimeout(()=>videoRef.current.srcObject=s,100);
                                }} className="w-full bg-black text-white py-5 rounded-2xl font-black mt-8 btn-press">Go to Biometrics</button>
                            </div>
                        )}

                        {step === 3 && (
                            <div className="text-center">
                                <h2 className="text-2xl font-black mb-6">Biometric Selfie</h2>
                                <div className="camera-container mx-auto mb-8"><video ref={videoRef} autoPlay playsInline className="video-feed" /></div>
                                <button onClick={captureBiometric} className="w-full bg-blue-600 text-white py-5 rounded-2xl font-black shadow-xl btn-press">{isSyncing ? "Encrypting..." : "Verify Identity"}</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const Messenger = ({ onBack, profile, visitor, rtdb }) => {
            const [msgs, setMsgs] = useState([]);
            const [input, setInput] = useState("");
            const scrollRef = useRef();

            useEffect(() => {
                const ref = rtdb.ref(`${DATA_PATH}/messages/${visitor.ts}`);
                ref.on('value', s => setMsgs(s.val() ? Object.values(s.val()) : []));
                return () => ref.off();
            }, []);

            useEffect(() => scrollRef.current?.scrollIntoView({ behavior: 'smooth' }), [msgs]);

            const send = async (type = 'text', media = "") => {
                if(type === 'text' && !input.trim()) return;
                await rtdb.ref(`${DATA_PATH}/messages/${visitor.ts}`).push({ type, text: input, media, sender: 'visitor', ts: Date.now() });
                setInput("");
            };

            return (
                <div className="fixed inset-0 z-[60] bg-white flex flex-col animate-modal">
                    <header className="p-4 border-b flex items-center justify-between glass sticky top-0 pt-safe">
                        <div className="flex items-center gap-3">
                            <button onClick={onBack} className="p-2 bg-slate-100 rounded-full btn-press"><Icon name="arrow" size={18}/></button>
                            <img src={profile?.avatar} className="w-10 h-10 rounded-full border border-slate-100 shadow-sm" />
                            <div><p className="font-bold text-sm leading-none">{profile?.name}</p><p className="text-[10px] text-green-500 font-bold uppercase mt-1">Recognized Device</p></div>
                        </div>
                    </header>
                    <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50/40 no-scrollbar">
                        {msgs.map((m, i) => (
                            <div key={i} className={`flex ${m.sender === 'visitor' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`chat-bubble ${m.sender === 'visitor' ? 'b-visitor' : 'b-admin'}`}>
                                    {m.type === 'image' ? <img src={m.media} className="rounded-xl w-full max-w-[200px]" /> : m.text}
                                </div>
                            </div>
                        ))}
                        <div ref={scrollRef} />
                    </div>
                    <div className="p-4 bg-white border-t flex items-center gap-3 pb-10">
                        <label className="text-blue-600 cursor-pointer btn-press"><Icon name="image" size={28} /><input type="file" className="hidden" accept="image/*" onChange={(e)=>{
                            const r = new FileReader(); r.readAsDataURL(e.target.files[0]);
                            r.onload = (ev) => send('image', ev.target.result);
                        }} /></label>
                        <input className="flex-1 bg-gray-100 rounded-full px-5 py-3 outline-none text-sm font-medium focus:ring-2 ring-blue-500/10 transition-all" placeholder="Message..." value={input} onChange={e=>setInput(e.target.value)} onKeyPress={e=>e.key==='Enter'&&send()} />
                        <button onClick={()=>send()} className="text-blue-600 btn-press"><Icon name="send" size={28} /></button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
